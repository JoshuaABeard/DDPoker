## Version 2026/02/11
## DD Poker LOCAL DEV subfolder reverse proxy configuration for SWAG
## Development configuration - tries DDPoker-Local first, falls back to DDPoker
## Use this if you prefer yourdomain.com/ddpoker instead of ddpoker.yourdomain.com
##
## INSTALLATION (for developers only):
## 1. Copy this file to your SWAG config: /config/nginx/proxy-confs/
## 2. Rename to: ddpoker.subfolder.conf (replace the production version)
## 3. Ensure both containers are on the same Docker network as SWAG
## 4. Restart SWAG container
##
## This config automatically routes to whichever container is running:
## - DDPoker-Local (dev container) - primary
## - DDPoker (production container) - fallback

location /ddpoker {
    return 301 $scheme://$host/ddpoker/;
}

location ^~ /ddpoker/ {
    include /config/nginx/proxy.conf;
    include /config/nginx/resolver.conf;

    # Try dev container first, fall back to production
    set $upstream_app DDPoker-Local;
    set $upstream_port 8080;
    set $upstream_proto http;
    proxy_pass $upstream_proto://$upstream_app:$upstream_port/;

    # Fallback to production container if dev is down
    proxy_intercept_errors on;
    error_page 502 503 504 = @ddpoker_fallback;
}

location @ddpoker_fallback {
    include /config/nginx/proxy.conf;
    include /config/nginx/resolver.conf;
    set $upstream_app DDPoker;
    set $upstream_port 8080;
    set $upstream_proto http;
    proxy_pass $upstream_proto://$upstream_app:$upstream_port/;
}
